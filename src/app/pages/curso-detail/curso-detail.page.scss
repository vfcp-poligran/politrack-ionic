// ==========================================================================
// Base Styles & Variables
// ==========================================================================

:host {
  // Asegura que el componente ocupe toda la altura si es necesario
  height: 100%;
}

ion-content {
  --offset-top: 0 !important; // Elimina espacio superior potencial
  --overflow: hidden; // Previene scroll en el contenedor principal
  display: flex; // Habilita flexbox para el layout principal
  flex-direction: column; // Apila los elementos verticalmente (header, filters, main-layout)
}

// Variables personalizadas (si no est치n en variables.scss globales)
// :root {
//   --poli-color-academic-blue: #003865; // Ejemplo
//   --poli-color-grade-excellent: #some-color; // Ejemplo
// }


// ==========================================================================
// Header (.curso-header)
// ==========================================================================

.curso-header {
  background: linear-gradient(135deg, var(--ion-color-primary), var(--poli-color-academic-blue, var(--ion-color-primary-shade))); // Fallback a침adido
  color: white;
  flex-shrink: 0; // Evita que el header se encoja

  ion-toolbar {
    --background: transparent;
    --color: white; // Heredado, pero expl칤cito por si acaso
    --border-width: 0;
    min-height: 64px; // Altura m칤nima consistente
  }

  .header-content {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 8px 16px; // Padding horizontal consistente

    .poli-logo {
      height: 32px;
      width: auto; // Mantiene proporci칩n
      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.2));
    }

    .header-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
      overflow: hidden; // Previene desbordamiento de texto

      .curso-title,
      .curso-subtitle {
        margin: 0;
        white-space: nowrap; // Evita saltos de l칤nea
        overflow: hidden;
        text-overflow: ellipsis; // A침ade '...' si el texto es muy largo
      }

      .curso-title {
        font: 800 24px/1.2 var(--ion-font-family); // Shorthand, ajuste line-height
        letter-spacing: -0.5px;
      }

      .curso-subtitle {
        font: 500 14px/1.2 var(--ion-font-family); // Shorthand, ajuste line-height
        opacity: 0.9;
      }
    }
  }

  // Estilo espec칤fico para botones en el header
  ion-button.header-action-button {
    --color: white; // Asegura color blanco
    --border-radius: 12px;
    margin: 0 4px; // Peque침o margen horizontal
    transition: transform 0.2s ease-out;

    &:hover { transform: scale(1.05); } // Efecto hover
    &[color="secondary"] { --background: rgba(var(--ion-color-secondary-rgb), 0.2); } // Fondo transl칰cido para secundario
  }
}

// ==========================================================================
// Filters Toolbar (.filters-toolbar)
// ==========================================================================

.filters-toolbar {
  background: var(--ion-background-color); // Fondo de la p치gina
  border-bottom: 1px solid var(--ion-color-step-150); // Borde inferior sutil
  padding: 12px 16px;
  flex-shrink: 0; // Evita que la barra de filtros se encoja

  ion-searchbar {
    --background: var(--ion-color-step-50); // Fondo ligeramente gris
    --border-radius: 16px; // Bordes redondeados
    --icon-color: var(--ion-color-primary); // Icono color primario
    margin-bottom: 12px; // Espacio debajo de la barra de b칰squeda
  }

  .filter-controls {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap; // Permite que los controles pasen a la siguiente l칤nea
    gap: 12px; // Espacio entre grupos de controles

    .filter-group {
      display: flex;
      align-items: center;
      gap: 12px; // Espacio entre controles dentro de un grupo
      flex-wrap: wrap; // Permite que los controles internos tambi칠n se envuelvan

      // Estilos espec칤ficos para el selector de subgrupo (ej: ion-select)
      .subgrupo-filter {
        min-width: 200px; // Ancho m칤nimo para el selector
        // Aplicar estilos adicionales directamente al componente si es necesario
      }
    }

    .estudiantes-count {
      background: rgba(var(--ion-color-primary-rgb), 0.1); // Fondo primario transl칰cido
      color: var(--ion-color-primary); // Texto color primario
      font: 700 14px/1 var(--ion-font-family); // Shorthand
      padding: 8px 16px;
      border-radius: 20px; // Bordes redondeados tipo "pill"
      white-space: nowrap; // Evita salto de l칤nea

      &::before { content: "游논"; margin-right: 6px; } // Icono emoji
    }
  }
}

// ==========================================================================
// Main Layout (.main-layout) -> Contenedor de Tabla y Panel
// ==========================================================================

.main-layout {
  display: flex;
  flex: 1; // Ocupa el espacio vertical restante disponible en ion-content
  gap: 15px; // Espacio entre la tabla y el panel
  padding: 15px; // Padding alrededor del layout principal
  background: var(--ion-color-step-50); // Fondo ligeramente gris
  overflow: hidden; // Previene scrollbars en este contenedor
}

// ==========================================================================
// Table Section (.table-section) -> Contenedor Izquierdo
// ==========================================================================

.table-section {
  flex: 1 1 auto; // Ocupa el espacio restante, permite encogerse
  min-width: 0; // Necesario para que flexbox permita encoger correctamente
  display: flex;
  flex-direction: column; // Apila toolbar y table-wrapper
  background: white; // Fondo blanco para la secci칩n de tabla
  border-radius: 8px; // Bordes redondeados
  overflow: hidden; // Clave para que el scroll interno funcione
  box-shadow: 0 2px 4px rgba(0,0,0,0.1); // Sombra suave

  // Toolbar dentro de la secci칩n de tabla (si existe)
  .toolbar-container {
    flex-shrink: 0; // No se encoge
    background: var(--ion-color-step-25); // Fondo muy claro
    border-bottom: 1px solid var(--ion-color-step-150); // Borde separador
    padding: 8px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between; // Espacio entre elementos del toolbar
    min-height: 56px; // Altura m칤nima
  }

  // Contenedor scrollable para la tabla
  .table-wrapper {
    flex: 1 1 auto; // Ocupa el espacio vertical restante
    overflow: auto; // Habilita scrollbars (vertical y horizontal) seg칰n necesidad
    position: relative; // Necesario para el funcionamiento de 'position: sticky'
    scroll-behavior: smooth; // Scroll suave (opcional)
  }
}

// --- Student Table Styles (.student-table) ---
.student-table {
  width: 100%; // Ocupa todo el ancho del wrapper
  border-collapse: collapse; // Estilo de borde est치ndar
  table-layout: auto; // Permite que el navegador ajuste anchos (puede ser 'fixed' si se prefieren anchos definidos)
  font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace; // Fuente monoespaciada para alineaci칩n

  th, td {
    border: 1px solid var(--ion-color-step-150); // Borde sutil
    padding: 4px 6px; // Padding compacto
    font-size: 13px; // Tama침o de fuente base
    text-align: center; // Centrado por defecto
    vertical-align: middle; // Alineaci칩n vertical
    transition: background-color 0.2s ease, color 0.2s ease; // Transici칩n suave
    color: var(--ion-text-color, #000); // Color de texto principal
    white-space: nowrap; // Prevenir saltos de l칤nea
  }

  // Fila del Encabezado
  .header-row {
    position: sticky; // Encabezado fijo
    top: 0; // Fijar en la parte superior del .table-wrapper
    z-index: 15; // Capa superior para estar sobre el contenido
    background: linear-gradient(135deg, var(--ion-color-primary), var(--poli-color-academic-blue, var(--ion-color-primary-shade))); // Gradiente
    color: white; // Texto blanco
    font-weight: 700;
    font-size: 12px; // Ligeramente m치s peque침o
    text-transform: uppercase; // May칰sculas
    letter-spacing: 0.5px; // Espaciado
    box-shadow: 0 4px 12px rgba(var(--ion-color-primary-rgb), 0.25); // Sombra inferior

    th {
      border-right: 1px solid rgba(255, 255, 255, 0.15); // Separador vertical sutil
      border-bottom: none; // Sin borde inferior
      padding: 8px 6px; // Padding del encabezado
      background: inherit; // Heredar fondo gradiente
      color: inherit; // Heredar color blanco

      &:hover { background: rgba(255, 255, 255, 0.1); } // Efecto hover
      &:last-child { border-right: none; } // Sin borde en la 칰ltima celda
    }
  }

  // Filas de Estudiantes
  .student-row {
    cursor: pointer; // Indica interactividad
    transition: background-color 0.3s ease;
    min-height: 32px; // Altura m칤nima de fila

    &:hover { background-color: var(--ion-color-step-50, #f8f9fa); } // Hover muy sutil

    // Estilo cuando la fila est치 seleccionada (checkbox)
    &.selected {
      background-color: var(--ion-color-primary-tint); // Fondo azul claro
      // Asegura que todas las celdas (normales y fijas) tengan el mismo fondo y color de texto
      td, .sticky-left, .sticky-right {
        background-color: inherit; // Heredar fondo azul claro
        color: var(--ion-text-color, #000); // Mantener color de texto est치ndar
      }
    }

    // Estilo cuando se est치 evaluando a este estudiante
    &.evaluando {
      background-color: var(--ion-color-warning-tint, #fef3c7); // Fondo amarillo claro
      td, .sticky-left, .sticky-right {
        background-color: inherit; // Heredar fondo amarillo
        color: var(--ion-text-color, #000); // Mantener color de texto est치ndar
      }
    }

    // Estilo temporal cuando se actualizan puntos
    &.puntos-actualizados {
      animation: puntosActualizadosRow 1.5s ease-out; // Animaci칩n de fondo en la fila
      // Estilo espec칤fico para las celdas de puntaje actualizadas
      .score-col, .editable-score {
        font-weight: 700; // Negrita
        color: var(--ion-color-success-shade); // Verde oscuro
      }
    }

    td { padding: 2px 6px; } // Padding muy compacto para celdas de datos
  }

  // Columnas Fijas (Sticky) a la Izquierda
  .sticky-left {
    position: sticky; // Fija
    background: white; // Fondo blanco por defecto para superponer sobre otras celdas
    z-index: 10; // Capa intermedia
    border-right: 2px solid var(--ion-color-step-150); // Borde derecho m치s grueso
    box-shadow: 4px 0 8px rgba(0, 0, 0, 0.08); // Sombra a la derecha

    // Columna Checkbox
    &.checkbox-col {
      left: 0; // Pegada al borde izquierdo
      width: 40px; min-width: 40px; // Ancho fijo
      padding: 0; // Sin padding
      text-align: center; vertical-align: middle; // Centrar contenido

      ion-checkbox {
        --size: 18px; --border-radius: 4px; --border-color: var(--ion-color-medium);
        --checkmark-color: white; --background-checked: var(--ion-color-primary);
        display: inline-flex; // Permite alineaci칩n vertical
        vertical-align: middle;
      }
    }

    // Columnas Apellidos y Nombres
    &.apellidos-col, &.nombres-col {
      min-width: 135px; max-width: 135px; // Ancho fijo
      text-align: left; // Alinear a la izquierda
      padding: 2px 8px 2px 4px; // Padding asim칠trico
      font-weight: 600; // Negrita
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis; // Manejo de texto largo
    }
    &.apellidos-col { left: 40px; } // Posici칩n despu칠s de checkbox
    &.nombres-col { left: 175px; } // Posici칩n despu칠s de apellidos (40 + 135)
  }

  // Columna Fija (Sticky) a la Derecha - Sumatoria
  .sticky-right.sum-col {
    position: sticky; // Fija
    right: 0; // Pegada al borde derecho
    background: white; // Fondo blanco por defecto
    z-index: 10; // Capa intermedia
    padding: 2px 6px; // Padding compacto
    box-shadow: -4px 0 8px rgba(0, 0, 0, 0.08); // Sombra a la izquierda
    border-left: 2px solid var(--ion-color-step-150); // Borde izquierdo m치s grueso
    font-weight: 800; // Muy negrita
    font-size: 14px; // Ligeramente m치s grande
    background: linear-gradient(135deg, rgba(var(--poli-color-grade-excellent-rgb, var(--ion-color-success-rgb)), 0.1), rgba(var(--ion-color-success-rgb), 0.05)); // Fondo degradado sutil
  }

  // Asegura que las columnas fijas en el header tengan el estilo correcto
  .header-row {
    .sticky-left, .sticky-right.sum-col {
      background: inherit; // Heredar fondo del header
      color: white; // Mantener texto blanco
      padding: 8px 6px; // Mantener padding del header
    }
  }

  // Estilos y Anchos de Columnas Espec칤ficas (no fijas)
  .grupo-col { width: 40px; min-width: 40px; font-weight: 700; } // Grupo
  .entrega-col, .score-col { width: 60px; min-width: 60px; font-weight: 600; } // PG, PI, E1, E2, EF

  // Celda de Puntaje Editable
  .editable-score {
    cursor: pointer; display: inline-block; padding: 4px 8px; border-radius: 4px;
    transition: all 0.2s ease; min-width: 32px; text-align: center; line-height: 1;
    border: 1px dashed transparent; // Borde oculto por defecto

    &:hover { // Estilo hover
      background-color: rgba(var(--ion-color-primary-rgb), 0.1); color: var(--ion-color-primary);
      transform: scale(1.05); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      border-color: rgba(var(--ion-color-primary-rgb), 0.3); // Mostrar borde
    }
    &:active { transform: scale(0.98); } // Efecto click
    &:empty::after { content: "-"; color: var(--ion-color-medium); font-style: italic; } // Placeholder si est치 vac칤o
  }
} // --- Fin .student-table ---


// ==========================================================================
// Seguimiento Panel Section (.seguimiento-panel) -> Contenedor Derecho Fijo
// ==========================================================================

.seguimiento-panel {
  flex: 0 0 450px; // Ancho fijo, no crece ni se encoge
  height: 100%; // Ocupa toda la altura disponible
  background: linear-gradient(180deg, var(--ion-color-step-50), var(--ion-background-color)); // Fondo degradado sutil
  border-left: 2px solid var(--ion-color-step-200); // Borde separador
  overflow: hidden; // El panel en s칤 no tiene scroll
  display: flex; flex-direction: column; // Apila header, content, footer
  box-shadow: -4px 0 16px rgba(0,0,0,0.1); // Sombra a la izquierda

  // --- Encabezado del Panel ---
  .seguimiento-header {
    flex-shrink: 0; // No se encoge
    display: flex; justify-content: space-between; align-items: center;
    padding: 16px 20px;
    background: linear-gradient(135deg, var(--ion-color-primary), var(--poli-color-academic-blue, var(--ion-color-primary-shade))); // Mismo gradiente que header principal
    color: white;
    border-bottom: 1px solid var(--ion-color-step-150); // Borde inferior
    flex-wrap: wrap; gap: 12px; // Permite envolver si no cabe

    h3 { // T칤tulo (Panel de Seguimiento / Nombre Estudiante)
      margin: 0; font: 700 18px/1 var(--ion-font-family);
      display: flex; align-items: center; gap: 12px; flex: 1; // Ocupa espacio
      // Estilos para el badge (ej: total criterios)
      .total-badge { background: rgba(255, 255, 255, 0.2); padding: 4px 12px; border-radius: 16px; font: 600 12px/1 var(--ion-font-family); }
    }

    // Resumen de evaluaci칩n en el header
    .evaluacion-resumen {
      background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 8px 12px; border-radius: 6px; display: flex; gap: 16px; align-items: center; flex-shrink: 0;

      .resumen-item { display: flex; align-items: center; gap: 8px; margin: 0;
        .label { font-size: 12px; color: rgba(255, 255, 255, 0.9); font-weight: 500; }
        .value { font-weight: 700; color: white; font-size: 14px; }
      }
      .progress-bar { width: 80px; height: 6px; background: rgba(255, 255, 255, 0.3); border-radius: 3px; overflow: hidden;
        .progress-fill { height: 100%; background: #fbbf24; border-radius: 3px; } // Relleno amarillo
      }
    }
    // Botones en el header del panel (si los hay)
    ion-button { --color: white; margin: 0; }
  } // --- Fin .seguimiento-header ---

  // --- Contenido Scrollable del Panel ---
  .seguimiento-content {
    flex: 1; // Ocupa el espacio vertical restante
    overflow-y: auto; // Habilita scroll vertical para este contenedor
    position: relative; // Necesario para elementos sticky internos

    // Tabs de Entrega (E1, E2, EF) - Fijas
    .entrega-tabs {
      background: var(--ion-background-color); padding: 6px 12px;
      border-bottom: 1px solid var(--ion-color-step-150);
      position: sticky; top: 0; z-index: 100; // Fija arriba del contenido scrollable

      ion-segment { --background: var(--ion-color-step-100); border-radius: 8px; min-height: 32px;
        ion-segment-button { /* Estilos consistentes */
          --color: var(--ion-color-medium); --color-checked: var(--ion-color-primary);
          --background-checked: white; --border-radius: 6px; --indicator-color: transparent;
          font-weight: 600; font-size: 13px; margin: 2px; min-height: 28px;
          --padding-top: 4px; --padding-bottom: 4px; transition: background-color 0.2s, color 0.2s;
        }
      }
    } // Fin .entrega-tabs

    // Informaci칩n/Selecci칩n de Subgrupo - Fija
    .subgroup-info {
      padding: 12px 20px; background: var(--ion-color-step-100);
      border-bottom: 1px solid var(--ion-color-step-150);
      position: sticky; top: 41px; z-index: 99; // Fija debajo de las tabs (ajustar 'top' si altura de tabs cambia)

      // Botones de selecci칩n de subgrupo (si est치n aqu칤)
      .subgroup-selection {
        // ... (Estilos si los botones van aqu칤) ...
        .subgroup-buttons { display: flex; gap: 4px; flex-wrap: nowrap; overflow-x: auto; // Scroll horizontal si hay muchos grupos
          ion-button { flex-shrink: 0; /* ... */ }
        }
      }
    } // Fin .subgroup-info

    // Contenedor real del contenido que hace scroll
    .scrollable-panel-content {
      padding: 16px; // Padding para el contenido interno

      // Placeholder si no hay evaluaci칩n activa
      .no-evaluacion-placeholder {
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        min-height: 300px; // Altura m칤nima para visibilidad
        text-align: center; color: var(--ion-color-medium); padding: 20px;
        ion-icon { font-size: 3em; margin-bottom: 10px; opacity: 0.7; }
        p { font-size: 1em; line-height: 1.5; }
      }

      // Tabla/Grid de la R칰brica
      .rubrica-table-container {
        background: white; border-radius: 12px; overflow: hidden; // Permite bordes redondeados
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); margin-top: 12px; // Separaci칩n superior

        // Encabezado de la tabla de r칰brica (NO fijo, se desplaza con el contenido)
        .rubrica-table-header {
            display: flex; background: linear-gradient(135deg, var(--ion-color-primary), var(--poli-color-academic-blue, var(--ion-color-primary-shade))); color: white;
            box-shadow: 0 4px 12px rgba(var(--ion-color-primary-rgb), 0.25); // Sombra inferior

            .header-criterio { /* Estilos columna criterio */
              width: 180px; min-width: 180px; padding: 10px 12px; font-size: 14px; font-weight: 700;
              border-right: 2px solid rgba(255, 255, 255, 0.3); display: flex; align-items: center; justify-content: center;
            }
            .header-nivel { /* Estilos columnas nivel */
              flex: 1; min-width: 180px; padding: 8px 12px; display: flex; flex-direction: column; align-items: center; justify-content: center;
              gap: 6px; cursor: pointer; transition: all 0.2s ease; border-right: 2px solid rgba(255, 255, 255, 0.2);
              &:last-child { border-right: none; }
              &:hover { background: rgba(255, 255, 255, 0.1); }
              // Estilo .active para selecci칩n masiva
              &.active { background: rgba(251, 191, 36, 0.3); border-bottom: 4px solid #fbbf24;
                ion-checkbox { --checkbox-background-checked: #fbbf24; --border-color-checked: #fbbf24; }
                .nivel-nombre { font-weight: 800; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2); }
              }
              ion-checkbox { /* Checkbox selecci칩n masiva */
                --size: 20px; --checkbox-background-checked: rgba(255, 255, 255, 0.9); --border-width: 2px;
                --border-color: rgba(255, 255, 255, 0.8); --checkmark-color: var(--ion-color-primary);
              }
              .nivel-nombre { /* Nombre nivel (Insuficiente, Aceptable...) */
                font-size: 12px; font-weight: 600; text-align: center; text-transform: uppercase; letter-spacing: 0.5px;
                cursor: pointer; user-select: none;
              }
            }
        } // Fin .rubrica-table-header

        // Cuerpo de la tabla de r칰brica
        .rubrica-table-body {
            overflow-x: hidden; // Evitar scroll horizontal aqu칤 si .seguimiento-content ya lo tiene vertical
           .rubrica-row { // Fila para cada criterio
             display: flex; border-bottom: 1px solid var(--ion-color-step-100, #e9ecef); // Separador
             &:last-child { border-bottom: none; }
             &:hover { background: var(--ion-color-step-25, #f8f9fa); } // Hover sutil

             // Celda del Criterio (Fija a la izquierda)
             .criterio-cell {
                position: sticky; left: 0; z-index: 10; // Fijar
                width: 180px; min-width: 180px; padding: 10px 12px; background: var(--ion-color-step-25, #f8fafc); // Fondo ligeramente diferente
                border-right: 2px solid var(--ion-color-step-150, #e9ecef); display: flex; flex-direction: column; gap: 6px;

                .criterio-header-row { display: flex; align-items: center; gap: 6px; } // Contenedor t칤tulo y bot칩n comentario
                h3 { margin: 0; font-size: 13px; font-weight: 600; color: var(--ion-text-color-step-800, #1e293b); line-height: 1.2; flex: 1; } // T칤tulo criterio
                .criterio-peso { font-size: 11px; color: var(--ion-color-step-600, #64748b); font-weight: 500; } // Peso (e.g., (5))
                .comentario-btn { // Bot칩n comentario
                  --padding-start: 0; --padding-end: 0; height: 22px; width: 22px; margin: 0; flex-shrink: 0;
                  ion-icon { font-size: 16px; color: var(--ion-color-warning, #f59e0b); } // Icono naranja
                  &:hover ion-icon { color: var(--ion-color-warning-shade, #d97706); } // M치s oscuro en hover
                  &.has-comment ion-icon { color: var(--ion-color-primary); } // Azul si tiene comentario
                }
             } // Fin .criterio-cell

             // Celdas de Niveles (Scrollable horizontalmente si es necesario, aunque no ideal)
             .nivel-cell {
                flex: 1; min-width: 180px; padding: 10px 12px; cursor: pointer; transition: all 0.2s ease;
                border-right: 1px solid var(--ion-color-step-100, #e9ecef); display: flex; align-items: center; justify-content: center; position: relative;
                &:last-child { border-right: none; }

                // Estilos base y hover por nivel (se mantienen los colores)
                &.nivel-0 { background: #eff6ff; &:hover { background: #dbeafe; } }
                &.nivel-1 { background: #fffbeb; &:hover { background: #fef3c7; } }
                &.nivel-2 { background: #f0fdf4; &:hover { background: #dcfce7; } }

                // Estilo cuando el nivel est치 seleccionado
                &.selected {
                   box-shadow: inset 0 0 0 3px var(--ion-color-warning, #fbbf24); // Borde interno amarillo
                   &::after { // Overlay amarillo sutil
                     content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
                     background: rgba(var(--ion-color-warning-rgb), 0.15); pointer-events: none; z-index: 0;
                   }
                   // Asegura que el texto sea legible sobre el overlay
                   .nivel-content, .nivel-header-inline, .nivel-valor, .nivel-rango, .nivel-descripcion {
                     position: relative; z-index: 1; color: var(--ion-text-color, #000) !important;
                   }
                   .nivel-valor { font-weight: 800; } // Puntaje m치s bold
                }

                // Contenido de la celda de nivel
                .nivel-content { text-align: center; width: 100%;
                  .nivel-header-inline { display: flex; align-items: baseline; justify-content: center; gap: 6px; margin-bottom: 8px; }
                  .nivel-valor { font-size: 28px; font-weight: 700; color: var(--ion-text-color-step-800, #1e293b); line-height: 1; } // Puntaje
                  .nivel-rango { font-size: 11px; color: var(--ion-color-step-600, #64748b); font-weight: 500; font-style: italic; } // Rango (0-5)
                  .nivel-descripcion { font-size: 11px; color: var(--ion-color-step-700, #475569); line-height: 1.4; margin: 0; text-align: left; } // Descripci칩n
                }
             } // Fin .nivel-cell
           } // Fin .rubrica-row
        } // Fin .rubrica-table-body
      } // Fin .rubrica-table-container

      // Resumen de la R칰brica (dentro del panel scrollable)
      .rubrica-resumen {
        margin: 16px 0 0 0; padding: 0; background: white; border-radius: 8px;
        border: 1px solid var(--ion-color-step-150); box-shadow: 0 1px 3px rgba(0,0,0,0.05);

        .resumen-titulo { margin: 0; font-size: 13px; font-weight: 600; color: var(--ion-text-color, #000); border-bottom: 1px solid var(--ion-color-step-150, #e5e7eb); padding: 10px 12px; background: var(--ion-color-step-25, #f9fafb); }
        .resumen-criterios { display: flex; flex-direction: column; gap: 0;
          .criterio-resumen { padding: 8px 12px; background: white; border-bottom: 1px solid var(--ion-color-step-150, #e5e7eb);
            &:last-child { border-bottom: none; }
            .criterio-header-resumen { font-size: 12px; margin-bottom: 4px; color: var(--ion-text-color, #000); font-weight: 600; .peso { font-weight: normal; color: var(--ion-color-step-600, #6b7280); margin-left: 4px; } }
            .criterio-niveles { margin-bottom: 4px; font-size: 10px; color: var(--ion-color-step-700, #4b5563); font-style: italic; }
            .criterio-evaluacion { margin-bottom: 4px; font-size: 11px; color: var(--ion-text-color, #000); .puntos { font-weight: bold; } }
            .criterio-descripcion { font-size: 10px; color: var(--ion-color-step-800, #374151); margin-bottom: 4px; line-height: 1.3; }
            .criterio-comentario { margin-top: 6px; padding: 6px 8px; background: var(--ion-color-step-50, #f3f4f6); border-radius: 4px; font-size: 10px; color: var(--ion-text-color-step-900, #1f2937); font-style: italic; line-height: 1.3; &:empty { display: none; } }
          }
        }
        .resumen-total-panel { padding: 10px 12px; background: var(--ion-color-step-25, #f9fafb); border-top: 1px solid var(--ion-color-step-150, #e5e7eb); text-align: right; font-size: 13px; font-weight: bold; color: var(--ion-color-primary); }
      } // Fin .rubrica-resumen

      // Comentarios Generales (dentro del panel scrollable)
      .comentarios-generales {
        margin-top: 16px; padding: 0;
        h3 { margin: 0 0 8px 0; font-size: 13px; font-weight: 600; color: var(--ion-text-color, #000); }
        ion-textarea {
          --border-radius: 8px; --background: white; --border-color: var(--ion-color-step-200);
          --color: var(--ion-text-color-step-800); --placeholder-color: var(--ion-color-step-500);
          --padding-start: 10px; --padding-end: 10px; --padding-top: 10px; --padding-bottom: 10px;
          min-height: 80px; border: 1px solid var(--border-color);
          &:focus-within, &.textarea-has-focus { --border-color: var(--ion-color-primary); box-shadow: 0 0 0 2px rgba(var(--ion-color-primary-rgb), 0.2); }
        }
      } // Fin .comentarios-generales

      // Rendimiento por Entregas (dentro del panel scrollable)
      .rendimiento-entregas {
        margin-top: 16px; padding-top: 12px; border-top: 1px solid var(--ion-color-step-150, #e5e7eb);
        .rendimiento-titulo { margin: 0 0 8px 0; font-size: 13px; font-weight: 600; color: var(--ion-text-color, #000); }
        .entrega-rendimiento { padding: 8px 0; border-bottom: 1px solid var(--ion-color-step-50, #f3f4f6); display: flex; gap: 8px; align-items: center;
          &:last-child { border-bottom: none; }
          .entrega-nombre { font-weight: 600; color: var(--ion-text-color, #000); font-size: 11px; min-width: 35px; }
          .entrega-info { color: var(--ion-color-step-800, #374151); font-size: 11px; flex: 1; }
        }
      } // Fin .rendimiento-entregas

    } // --- Fin .scrollable-panel-content ---

    // Footer de Acciones Fijo (dentro del panel scrollable)
    .panel-actions {
      display: flex; justify-content: flex-end; gap: 10px; padding: 16px;
      border-top: 1px solid var(--ion-color-step-150, #eee); background: var(--ion-color-step-25, #f9f9f9);
      position: sticky; bottom: 0; z-index: 100; // Fijo abajo

      ion-button { font-size: 0.9em; --border-radius: 8px; font-weight: 600; min-height: 40px;
        // Estilos espec칤ficos para Cancelar y Guardar/Finalizar
        &[color="medium"] { --background: var(--ion-color-step-200); --color: var(--ion-color-step-700); &:hover { --background: var(--ion-color-step-300); } }
        &[color="success"] { --box-shadow: 0 2px 8px rgba(var(--ion-color-success-rgb), 0.3);
          &:hover:not(:disabled) { --background: var(--ion-color-success-shade); transform: translateY(-1px); --box-shadow: 0 4px 12px rgba(var(--ion-color-success-rgb), 0.4); }
          &:disabled { --background: var(--ion-color-step-200); --color: var(--ion-color-step-400); --box-shadow: none; opacity: 0.7; cursor: not-allowed; }
        }
      }
    } // --- Fin .panel-actions ---

  } // --- Fin .seguimiento-content ---
} // ================= Fin .seguimiento-panel ==========================


// ==========================================================================
// Responsive Adjustments
// ==========================================================================

// --- Tablet Breakpoint ---
@media (max-width: 1024px) {
  .main-layout {
    flex-direction: column; // Apilar verticalmente
    height: auto; // Altura autom치tica
    overflow-y: auto; // Scroll en layout principal si es necesario

    .table-section,
    .seguimiento-panel {
      flex: none; // Sin flex-grow/shrink
      width: 100%; // Ancho completo
      height: auto; // Altura autom치tica
      max-height: 60vh; // Limitar altura
      min-height: 300px; // Altura m칤nima
    }

    .seguimiento-panel {
      max-height: 50vh; // Panel m치s peque침o
      border-left: none; // Sin borde izquierdo
      border-top: 2px solid var(--ion-color-step-200); // Borde superior
      box-shadow: 0 -4px 16px rgba(0,0,0,0.1); // Sombra superior
    }
  }
}

// --- Mobile Breakpoint ---
@media (max-width: 768px) {
   .main-layout { padding: 8px; gap: 8px; } // Reducir espacios

  // Ajustes barra de filtros
  .filters-toolbar { padding: 8px 12px;
    .filter-controls { flex-direction: column; align-items: stretch; gap: 8px;
      .filter-group { justify-content: center; }
      .subgrupo-filter { min-width: auto; width: 100%; }
      .estudiantes-count { align-self: center; }
    }
  }

  // Ajustar alturas m치ximas en m칩vil
   .table-section { max-height: 55vh; }
   .seguimiento-panel { max-height: 45vh; min-height: 250px; }


  // Tabla m치s compacta en m칩vil
  .student-table {
    font-size: 12px; // Fuente general m치s peque침a
    th, td { padding: 3px 4px; } // Padding muy compacto
    .header-row th { padding: 6px 4px; font-size: 11px; } // Header m치s compacto

    // Anchos columnas fijas en m칩vil
    .sticky-left {
      &.checkbox-col { width: 35px; min-width: 35px; }
      &.apellidos-col { left: 35px; min-width: 100px; max-width: 100px; }
      &.nombres-col { left: 135px; min-width: 100px; max-width: 100px; }
    }
    .grupo-col { width: 35px; min-width: 35px; }
    .entrega-col, .score-col { width: 50px; min-width: 50px; font-size: 12px; }
    .score-col.sum-col { font-size: 13px; }
    .sticky-right { padding: 2px 4px; }
  }

   // Panel de seguimiento m치s compacto en m칩vil
   .seguimiento-panel {
      .seguimiento-header { padding: 12px 16px; h3 { font-size: 16px; } .evaluacion-resumen { display: none; } } // Header simplificado
      .seguimiento-content {
         .entrega-tabs ion-segment-button { font-size: 12px; min-height: 26px; } // Tabs m치s peque침as
         .subgroup-info { padding: 8px 16px; top: 39px; } // Ajustar sticky top
         .scrollable-panel-content { padding: 12px; } // Padding reducido

         // R칰brica a칰n m치s compacta en m칩vil
         .rubrica-table-container {
             .rubrica-table-header { // Header r칰brica
                 .header-criterio { width: 80px; min-width: 80px; font-size: 11px; padding: 6px;}
                 .header-nivel { min-width: 100px; padding: 4px 6px; .nivel-nombre { font-size: 10px;} ion-checkbox { --size: 16px;}}
             }
             .rubrica-table-body { // Cuerpo r칰brica
                 .rubrica-row {
                     .criterio-cell { width: 80px; min-width: 80px; padding: 6px; h3 { font-size: 10px;} .criterio-peso {font-size: 8px;} .comentario-btn { height: 16px; width: 16px; ion-icon {font-size: 12px;}}}
                     .nivel-cell { min-width: 100px; padding: 6px;
                         .nivel-content { // Contenido nivel
                            .nivel-header-inline { gap: 3px; margin-bottom: 4px;}
                            .nivel-valor { font-size: 18px; }
                            .nivel-rango { font-size: 8px; }
                            .nivel-descripcion { font-size: 9px; line-height: 1.2; }
                         }
                     }
                 }
             }
         } // Fin r칰brica compacta

         .rubrica-resumen {
            margin: 12px 0 0 0;
            .resumen-titulo { font-size: 12px; padding: 8px 10px; }
            .resumen-criterios .criterio-resumen { padding: 6px 10px;
              .criterio-header-resumen { font-size: 11px; }
              .criterio-niveles, .criterio-evaluacion { font-size: 9px; margin-bottom: 3px; }
              .criterio-descripcion, .criterio-comentario { font-size: 9px; line-height: 1.2; }
            }
            .resumen-total-panel { padding: 8px 10px; font-size: 12px; }
         }
         .comentarios-generales h3 {font-size: 12px;}
         .rendimiento-entregas {
            margin-top: 12px;
            .rendimiento-titulo { font-size: 12px; margin-bottom: 6px; }
            .entrega-rendimiento { padding: 6px 0;
              .entrega-nombre { font-size: 10px; min-width: 30px; }
              .entrega-info { font-size: 10px; }
            }
         }
         .panel-actions { padding: 10px; gap: 6px; ion-button {min-height: 32px; font-size: 0.8em;} } // Acciones m치s peque침as

      } // Fin .seguimiento-content m칩vil
   } // Fin .seguimiento-panel m칩vil
} // Fin media query m칩vil (768px)

// ==========================================================================
// Utility Styles (Animations, Flags, Placeholders, etc.)
// ==========================================================================

// Placeholder (reutilizado de .empty-state y .loading-container si es similar)
.loading-container,
.empty-state {
  display: flex; flex-direction: column; justify-content: center; align-items: center;
  min-height: 300px; // Altura m칤nima
  padding: 48px 32px; text-align: center; color: var(--ion-color-medium);
}
.loading-container ion-spinner { width: 60px; height: 60px; --color: var(--ion-color-primary); margin-bottom: 24px; }
.loading-container p { font-size: 18px; font-weight: 500; }
.empty-state .empty-icon { font-size: 120px; background: linear-gradient(135deg, var(--ion-color-primary), var(--ion-color-secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 32px; opacity: 0.6; animation: float 3s ease-in-out infinite; }
.empty-state h2 { font-size: 28px; font-weight: 800; margin-bottom: 12px; color: var(--ion-color-dark); letter-spacing: -0.5px; }
.empty-state p { font-size: 18px; line-height: 1.6; }

// Animaciones
@keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
@keyframes puntosActualizadosRow { 0% { background-color: var(--ion-color-success-tint); } 100% { background-color: transparent; } }
@keyframes wave { from { transform: rotate(-10deg); } to { transform: rotate(10deg); } }

// Estilo Icono Bandera (Comentario)
.flag-icon { color: #dc2626; font-size: 14px; margin-left: 4px; /* animation: wave 0.8s ... */ }

// A침adir otros estilos utilitarios seg칰n necesidad

